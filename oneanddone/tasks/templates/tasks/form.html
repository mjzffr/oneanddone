{# This Source Code Form is subject to the terms of the Mozilla Public
 # License, v. 2.0. If a copy of the MPL was not distributed with this
 # file, You can obtain one at http://mozilla.org/MPL/2.0/. #}

{% extends 'base/base.html' %}

{% block site_css %}
  {{ super() }}
  {{ task_form.media['css'] }}
{% endblock %}

{% block site_js %}
  {{ super() }}
  {{ task_form.media['js'] }}
  <script src="{{ static('js/criterion-formset.js') }}"></script>
{% endblock %}

{% from 'tasks/macros.html' import form_field %}
{% if action == 'Import' %}
  {% set title = _('{action} task batch')|f(action=action) %}
{% else %}
  {% set title = _('{action} task {task_name}')|f(action=action,task_name=task_form['name'].value() or '') %}
{% endif %}

{% block content %}
<main class="billboard content-container feedback">

{% if action == 'Add' %}
  <div style="float:right">
    <a href="{{ url('tasks.import') }}" class="button">{{ _('Import Tasks') }}</a>
  </div>
{% endif %}

  <h4>{{ title }}</h4>

{% if action == 'Import' %}
  {{ batch_form.non_field_errors() }}
  {{ criterion_formset.non_form_errors() }}
{% endif %}
  {{ task_form.non_field_errors() }}

  <form method="post" class="task-form">
    {{ csrf() }}

    {% if action == 'Import' %}
      <input type="hidden" name="stage" value="preview" />
      <div class="row">
        <div "one-field">{{ form_field(batch_form['description'], True) }}</div>
      </div>
      <div class="row">
        <div "one-field">{{ form_field(batch_form['query'], True) }}</div>
      </div>

      {% include 'tasks/criterion_formset.html' %}

      <h5>{{ _('Base Task Description') }}</h5>
    {% endif %}

    <div class="row">
      <div "one-field">{{ form_field(task_form['name'], True) }}</div>
    </div>
    <div class="row">
      <div "one-field">{{ form_field(task_form['short_description'], True) }}</div>
    </div>
    <div class="row">
      <div class="one-field">{{ form_field(task_form['keywords']) }}</div>
    </div>
    <div class="row">
      <div class="two-fields">{{ form_field(task_form['execution_time']) }}</div>
      <div class="two-fields">{{ form_field(task_form['difficulty']) }}</div>
    </div>
    <div class="row">
      <div class="three-fields">{{ form_field(task_form['team'], True) }}</div>
      <div class="three-fields">{{ form_field(task_form['project']) }}</div>
      <div class="three-fields">{{ form_field(task_form['type']) }}</div>
    </div>
    <div class="row">
      <div class="three-fields">{{ form_field(task_form['start_date']) }}</div>
      <div class="three-fields">{{ form_field(task_form['end_date']) }}</div>
      <div class="three-fields">{{ form_field(task_form['repeatable']) }}</div>
    </div>
    <div class="row">
      <div class="one-field">{{ form_field(task_form['why_this_matters']) }}</div>
    </div>
    <div class="row">
      <div class="one-field">{{ form_field(task_form['prerequisites']) }}</div>
    </div>
    <div class="row">
      <div class="one-field">{{ form_field(task_form['instructions'], True) }}</div>
    </div>
    <div class="row">
      <div class="one-field">{{ form_field(task_form['is_draft']) }}</div>
      <div class="one-field">{{ form_field(task_form['is_valid']) }}</div>
    </div>

    <div class="row">
      <div class="actions-container">
        <div class="without-message">
          <a href="{{ cancel_url }}" class="button" id="cancel">{{ _('Cancel') }}</a>
        </div>
        <button type="submit" class="button">
          {{ _('{action} {import_obj}')|f(action=action, import_obj=import_obj or 'task') }}
        </button>
      </div>
    </div>
  </form>
</main>
{% endblock %}
